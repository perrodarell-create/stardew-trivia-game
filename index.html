<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stardew Trivia Plus - Juego de Preguntas y Cultivo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }
        
        body {
            background-color: #8eb971;
            color: #3a3a3a;
            padding: 20px;
            background-image: url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect width="100" height="100" fill="%238eb971"/><path d="M0 50 L100 50 M50 0 L50 100" stroke="%2375a257" stroke-width="1"/></svg>');
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: #f5f5dc;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            border: 8px solid #d4a574;
            position: relative;
            overflow: hidden;
        }
        
        .container:before {
            content: "";
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            border: 2px solid #8b4513;
            border-radius: 20px;
            pointer-events: none;
        }
        
        header {
            text-align: center;
            margin-bottom: 25px;
            border-bottom: 3px dashed #8b4513;
            padding-bottom: 15px;
        }
        
        h1 {
            color: #4a6b2f;
            font-size: 2.8rem;
            text-shadow: 2px 2px 0 #d4a574;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #5d7a3d;
            font-size: 1.2rem;
            font-style: italic;
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .stats-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .stat-box {
            background-color: #e8d8b6;
            padding: 10px 15px;
            border-radius: 8px;
            border: 3px solid #d4a574;
            min-width: 120px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #5d7a3d;
            display: block;
        }
        
        .stat-value {
            font-size: 1.8rem;
            color: #4a6b2f;
            font-weight: bold;
        }
        
        .hearts-container {
            display: flex;
            gap: 5px;
            align-items: center;
        }
        
        .heart {
            font-size: 1.8rem;
            color: #e74c3c;
        }
        
        .timer-container {
            background-color: #2c3e50;
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 1.5rem;
            font-weight: bold;
            border: 3px solid #1a252f;
        }
        
        .timer.warning {
            color: #f39c12;
            animation: pulse 1s infinite;
        }
        
        .timer.danger {
            color: #e74c3c;
            animation: pulse 0.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .game-area {
            background-color: #f0e6cc;
            border-radius: 10px;
            padding: 25px;
            border: 3px solid #d4a574;
            margin-bottom: 25px;
            min-height: 380px;
        }
        
        .character-container {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            gap: 20px;
            background-color: #f9f3e9;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #8b4513;
        }
        
        .character-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid #d4a574;
            background-color: #e8d8b6;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
        }
        
        .character-message {
            flex-grow: 1;
            font-size: 1.2rem;
            font-style: italic;
            color: #3a3a3a;
            padding: 10px;
            background-color: #fff;
            border-radius: 8px;
            border-left: 4px solid #4a6b2f;
        }
        
        .character-help-btn {
            background-color: #4a6b2f;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            white-space: nowrap;
        }
        
        .character-help-btn:hover {
            background-color: #5d7a3d;
            transform: translateY(-2px);
        }
        
        .character-help-btn:disabled {
            background-color: #aaaaaa;
            cursor: not-allowed;
            transform: none;
        }
        
        .question-box {
            background-color: #f9f3e9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-left: 5px solid #8b4513;
        }
        
        .question-number {
            font-size: 1rem;
            color: #8b4513;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .question-text {
            font-size: 1.4rem;
            color: #3a3a3a;
            line-height: 1.4;
        }
        
        .options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .option-btn {
            padding: 15px;
            background-color: #e8d8b6;
            border: 3px solid #d4a574;
            border-radius: 10px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s;
            color: #3a3a3a;
        }
        
        .option-btn:hover {
            background-color: #d4a574;
            transform: translateY(-3px);
        }
        
        .option-btn.selected {
            background-color: #a8d08d;
            border-color: #4a6b2f;
            color: #2c4a1f;
        }
        
        .option-btn.correct {
            background-color: #8bc34a;
            border-color: #4a6b2f;
            color: #2c4a1f;
        }
        
        .option-btn.incorrect {
            background-color: #f44336;
            border-color: #b71c1c;
            color: #fff;
        }
        
        .option-btn:disabled {
            cursor: not-allowed;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .action-btn {
            padding: 15px 30px;
            background-color: #4a6b2f;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
            border-bottom: 4px solid #2c4a1f;
        }
        
        .action-btn:hover {
            background-color: #5d7a3d;
            transform: translateY(-2px);
        }
        
        .action-btn:disabled {
            background-color: #aaaaaa;
            border-bottom-color: #888888;
            cursor: not-allowed;
            transform: none;
        }
        
        .shop-btn {
            background-color: #d4a574;
            color: #3a3a3a;
            border-bottom: 4px solid #b5946a;
        }
        
        .shop-btn:hover {
            background-color: #e0b584;
        }
        
        /* Minijuego de cultivo */
        .minigame-container {
            text-align: center;
            padding: 20px;
        }
        
        .minigame-title {
            font-size: 2rem;
            color: #4a6b2f;
            margin-bottom: 20px;
        }
        
        .minigame-instructions {
            font-size: 1.2rem;
            margin-bottom: 25px;
            color: #3a3a3a;
            background-color: #f9f3e9;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #d4a574;
        }
        
        .crop-selection {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .crop-option {
            padding: 15px;
            background-color: #e8d8b6;
            border: 3px solid #d4a574;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            min-width: 120px;
        }
        
        .crop-option:hover {
            background-color: #d4a574;
            transform: translateY(-3px);
        }
        
        .crop-option.selected {
            background-color: #a8d08d;
            border-color: #4a6b2f;
        }
        
        .crop-icon {
            font-size: 2.5rem;
            display: block;
            margin-bottom: 10px;
        }
        
        .crop-name {
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .crop-points {
            font-size: 0.9rem;
            color: #5d7a3d;
        }
        
        .farm-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin: 25px auto;
            max-width: 500px;
        }
        
        .farm-plot {
            aspect-ratio: 1/1;
            background-color: #a0522d;
            border: 3px solid #8b4513;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .farm-plot.planted {
            background-color: #8fbc8f;
        }
        
        .farm-plot.harvestable {
            background-color: #9acd32;
            animation: harvest-glow 1.5s infinite;
            cursor: pointer;
        }
        
        @keyframes harvest-glow {
            0% { box-shadow: 0 0 5px #9acd32; }
            50% { box-shadow: 0 0 15px #9acd32; }
            100% { box-shadow: 0 0 5px #9acd32; }
        }
        
        .minigame-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 25px;
        }
        
        .minigame-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            font-size: 1.2rem;
        }
        
        /* Tienda */
        .shop-container {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .shop-title {
            font-size: 2rem;
            color: #8b4513;
            margin-bottom: 20px;
        }
        
        .shop-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .shop-item {
            background-color: #f9f3e9;
            padding: 20px;
            border-radius: 10px;
            border: 3px solid #d4a574;
            transition: all 0.2s;
        }
        
        .shop-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .item-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .item-name {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #4a6b2f;
        }
        
        .item-cost {
            font-size: 1.2rem;
            color: #8b4513;
            margin-bottom: 15px;
        }
        
        .buy-btn {
            background-color: #4a6b2f;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            width: 100%;
        }
        
        .buy-btn:hover:not(:disabled) {
            background-color: #5d7a3d;
        }
        
        .buy-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .result-screen {
            text-align: center;
            padding: 30px;
        }
        
        .result-title {
            font-size: 2.5rem;
            color: #4a6b2f;
            margin-bottom: 20px;
        }
        
        .result-score {
            font-size: 4rem;
            color: #8b4513;
            margin: 20px 0;
        }
        
        .result-message {
            font-size: 1.3rem;
            margin-bottom: 30px;
            color: #3a3a3a;
        }
        
        .farm-decoration {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            opacity: 0.7;
        }
        
        .decoration-item {
            font-size: 2.5rem;
        }
        
        @media (max-width: 768px) {
            .options-container {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .game-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .stats-container {
                justify-content: center;
            }
            
            .character-container {
                flex-direction: column;
                text-align: center;
            }
            
            .farm-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚òÖ Stardew Trivia Plus ‚òÖ</h1>
            <p class="subtitle">Responde preguntas, cultiva y canjea recompensas</p>
        </header>
        
        <div class="game-header">
            <div class="stats-container">
                <div class="stat-box">
                    <span class="stat-label">PUNTOS</span>
                    <span class="stat-value" id="points">0</span>
                </div>
                <div class="stat-box">
                    <span class="stat-label">PREGUNTA</span>
                    <span class="stat-value" id="question-count">1/10</span>
                </div>
                <div class="stat-box">
                    <span class="stat-label">CORAZONES</span>
                    <div class="hearts-container" id="hearts-container">
                        <!-- Los corazones se generan din√°micamente -->
                    </div>
                </div>
            </div>
            
            <div class="timer-container">
                Tiempo: <span class="timer" id="timer">15</span>s
            </div>
        </div>
        
        <div class="game-area" id="game-area">
            <!-- El contenido del juego se cargar√° aqu√≠ din√°micamente -->
        </div>
        
        <div class="farm-decoration">
            <div class="decoration-item">üåª</div>
            <div class="decoration-item">üêî</div>
            <div class="decoration-item">üöú</div>
            <div class="decoration-item">üåΩ</div>
            <div class="decoration-item">üêÑ</div>
        </div>
    </div>

    <script>
        // Variables del juego
        let currentQuestionIndex = 0;
        let points = 0;
        let hearts = 3;
        let helpTokens = 3;
        let selectedOption = null;
        let gameActive = true;
        let timer;
        let timeLeft = 15;
        let currentCharacter = null;
        let encouragementPhrases = [];
        let hintPhrases = [];
        let minigameActive = false;
        let minigamePoints = 0;
        let plantedCrops = [];
        let selectedCrop = null;
        let cropTimers = [];
        
        // Personajes de Stardew Valley
        const characters = [
            {
                name: "Abigail",
                emoji: "üíú",
                color: "#9b59b6",
                encouragements: [
                    "¬°Vamos, t√∫ puedes!",
                    "¬°Eres m√°s fuerte de lo que piensas!",
                    "¬°Concentraci√≥n, lo tienes!",
                    "¬°No te rindas ahora!"
                ],
                hints: [
                    "Creo que la respuesta podr√≠a ser...",
                    "He o√≠do algo sobre eso...",
                    "Mi instinto me dice que...",
                    "Recuerdo algo similar..."
                ]
            },
            {
                name: "Sebasti√°n",
                emoji: "üê∏",
                color: "#34495e",
                encouragements: [
                    "Sigue adelante...",
                    "No est√° mal...",
                    "Puedes hacerlo.",
                    "Sigue as√≠."
                ],
                hints: [
                    "Podr√≠a estar equivocado, pero...",
                    "Tal vez sea...",
                    "No estoy seguro, pero prueba con...",
                    "Creo recordar que..."
                ]
            },
            {
                name: "Leah",
                emoji: "üé®",
                color: "#27ae60",
                encouragements: [
                    "¬°Eres capaz!",
                    "¬°Qu√© bien lo haces!",
                    "¬°Sigue as√≠!",
                    "¬°Lo tienes casi!"
                ],
                hints: [
                    "La naturaleza me dice que...",
                    "Por lo que he observado...",
                    "Creo que la respuesta es...",
                    "Mi intuici√≥n art√≠stica sugiere..."
                ]
            },
            {
                name: "Harvey",
                emoji: "üë®‚Äç‚öïÔ∏è",
                color: "#3498db",
                encouragements: [
                    "¬°An√≠mate, vas bien!",
                    "¬°Excelente trabajo!",
                    "¬°Contin√∫a con ese ritmo!",
                    "¬°Muy bien, sigue as√≠!"
                ],
                hints: [
                    "Desde un punto de vista cient√≠fico...",
                    "Los datos sugieren que...",
                    "Basado en la evidencia...",
                    "Mi diagn√≥stico ser√≠a..."
                ]
            }
        ];
        
        // Preguntas del juego
        const questions = [
            {
                question: "¬øCu√°nto tiempo tarda en crecer una planta de ma√≠z desde que se siembra?",
                options: ["3 d√≠as", "7 d√≠as", "14 d√≠as", "21 d√≠as"],
                correctAnswer: 2,
                hint: "Es m√°s de una semana pero menos de tres..."
            },
            {
                question: "¬øQu√© animal de granja produce leche?",
                options: ["Gallina", "Oveja", "Vaca", "Cerdito"],
                correctAnswer: 2,
                hint: "Es el animal m√°s grande de esas opciones..."
            },
            {
                question: "¬øCu√°l es la herramienta principal para arar la tierra?",
                options: ["Hoz", "Azada", "Tractor", "Rastrillo"],
                correctAnswer: 1,
                hint: "Es una herramienta manual con un borde afilado..."
            },
            {
                question: "¬øEn qu√© estaci√≥n se suele cosechar la uva?",
                options: ["Primavera", "Verano", "Oto√±o", "Invierno"],
                correctAnswer: 2,
                hint: "Es la estaci√≥n de las hojas ca√≠das..."
            },
            {
                question: "¬øQu√© necesitan las gallinas para producir huevos regularmente?",
                options: ["Granos", "Agua", "Luz solar", "Todas las anteriores"],
                correctAnswer: 3,
                hint: "Piensa en todas sus necesidades b√°sicas..."
            },
            {
                question: "¬øQu√© cultivo es t√≠pico del verano?",
                options: ["Fresa", "Tomate", "Calabaza", "Br√≥coli"],
                correctAnswer: 1,
                hint: "Es rojo y se usa en ensaladas..."
            },
            {
                question: "¬øQu√© producto se obtiene de las abejas?",
                options: ["Cera", "Miel", "Jalea real", "Todas las anteriores"],
                correctAnswer: 3,
                hint: "Las abejas producen m√°s de una cosa √∫til..."
            },
            {
                question: "¬øPara qu√© sirve un espantap√°jaros en la granja?",
                options: ["Decoraci√≥n", "Asustar p√°jaros", "Proteger del sol", "Guardar herramientas"],
                correctAnswer: 1,
                hint: "Su nombre es bastante descriptivo..."
            },
            {
                question: "¬øCu√°l es el prop√≥sito de rotar los cultivos?",
                options: ["Evitar plagas", "Mejorar el suelo", "Ambas son correctas", "Ninguna es correcta"],
                correctAnswer: 2,
                hint: "Tiene beneficios m√∫ltiples..."
            },
            {
                question: "¬øQu√© animal ayuda a controlar las plagas de roedores en la granja?",
                options: ["Perro", "Gato", "Conejo", "Caballo"],
                correctAnswer: 1,
                hint: "Es un cazador natural de ratones..."
            }
        ];
        
        // Cultivos para el minijuego
        const crops = [
            { name: "Papa", emoji: "ü•î", points: 10, growthTime: 3000 },
            { name: "Tomate", emoji: "üçÖ", points: 15, growthTime: 2500 },
            { name: "Coliflor", emoji: "ü•¶", points: 20, growthTime: 4000 },
            { name: "Zanahoria", emoji: "ü•ï", points: 12, growthTime: 2800 }
        ];
        
        // Items de la tienda
        const shopItems = [
            { id: 1, name: "Vida extra", emoji: "‚ù§Ô∏è", cost: 50, effect: "addHeart" },
            { id: 2, name: "Pista adicional", emoji: "üí°", cost: 30, effect: "addHint" },
            { id: 3, name: "Tiempo extra", emoji: "‚è∞", cost: 40, effect: "addTime" },
            { id: 4, name: "Doble puntos", emoji: "‚≠ê", cost: 60, effect: "doublePoints" }
        ];
        
        // Elementos del DOM
        const gameArea = document.getElementById('game-area');
        const pointsElement = document.getElementById('points');
        const questionCountElement = document.getElementById('question-count');
        const heartsContainer = document.getElementById('hearts-container');
        const timerElement = document.getElementById('timer');
        
        // Inicializar el juego
        function initGame() {
            currentQuestionIndex = 0;
            points = 0;
            hearts = 3;
            helpTokens = 3;
            gameActive = true;
            minigamePoints = 0;
            updateUI();
            selectRandomCharacter();
            loadQuestion();
            startTimer();
        }
        
        // Actualizar la interfaz
        function updateUI() {
            pointsElement.textContent = points;
            questionCountElement.textContent = `${currentQuestionIndex + 1}/${questions.length}`;
            
            // Actualizar corazones
            heartsContainer.innerHTML = '';
            for (let i = 0; i < 5; i++) {
                const heart = document.createElement('div');
                heart.className = 'heart';
                heart.textContent = i < hearts ? '‚ù§Ô∏è' : 'ü§ç';
                heartsContainer.appendChild(heart);
            }
        }
        
        // Seleccionar un personaje aleatorio
        function selectRandomCharacter() {
            currentCharacter = characters[Math.floor(Math.random() * characters.length)];
            encouragementPhrases = [...currentCharacter.encouragements];
            hintPhrases = [...currentCharacter.hints];
        }
        
        // Obtener una frase de √°nimo aleatoria
        function getEncouragement() {
            if (encouragementPhrases.length === 0) {
                encouragementPhrases = [...currentCharacter.encouragements];
            }
            const randomIndex = Math.floor(Math.random() * encouragementPhrases.length);
            return encouragementPhrases.splice(randomIndex, 1)[0];
        }
        
        // Obtener una pista aleatoria
        function getHint() {
            if (hintPhrases.length === 0) {
                hintPhrases = [...currentCharacter.hints];
            }
            const randomIndex = Math.floor(Math.random() * hintPhrases.length);
            return hintPhrases.splice(randomIndex, 1)[0];
        }
        
        // Iniciar el temporizador
        function startTimer() {
            timeLeft = 15;
            updateTimerDisplay();
            
            if (timer) clearInterval(timer);
            
            timer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    timeUp();
                }
            }, 1000);
        }
        
        // Actualizar la visualizaci√≥n del temporizador
        function updateTimerDisplay() {
            timerElement.textContent = timeLeft;
            
            // Cambiar color seg√∫n el tiempo restante
            timerElement.className = 'timer';
            if (timeLeft <= 5) {
                timerElement.classList.add('danger');
            } else if (timeLeft <= 10) {
                timerElement.classList.add('warning');
            }
        }
        
        // Cuando se acaba el tiempo
        function timeUp() {
            if (!gameActive || minigameActive) return;
            
            loseHeart();
            showMessage("¬°Se acab√≥ el tiempo! Pierdes un coraz√≥n.");
            
            // Deshabilitar botones
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.disabled = true;
            });
            
            // Mostrar respuesta correcta
            const question = questions[currentQuestionIndex];
            const optionButtons = document.querySelectorAll('.option-btn');
            optionButtons[question.correctAnswer].classList.add('correct');
            
            // Pasar a la siguiente pregunta despu√©s de un retraso
            setTimeout(nextQuestion, 2000);
        }
        
        // Perder un coraz√≥n
        function loseHeart() {
            hearts--;
            updateUI();
            
            if (hearts <= 0) {
                gameOver();
            }
        }
        
        // Cargar la pregunta actual
        function loadQuestion() {
            const question = questions[currentQuestionIndex];
            const encouragement = getEncouragement();
            
            gameArea.innerHTML = `
                <div class="character-container">
                    <div class="character-avatar" style="border-color: ${currentCharacter.color}">
                        <span style="font-size: 2.5rem;">${currentCharacter.emoji}</span>
                    </div>
                    <div class="character-message">
                        <strong>${currentCharacter.name}:</strong> ${encouragement}
                    </div>
                    <button class="character-help-btn" id="help-btn" onclick="useHelp()" ${helpTokens <= 0 ? 'disabled' : ''}>
                        Pedir ayuda (${helpTokens} restantes)
                    </button>
                </div>
                <div class="question-box">
                    <div class="question-number">Pregunta ${currentQuestionIndex + 1}</div>
                    <div class="question-text">${question.question}</div>
                </div>
                <div class="options-container">
                    ${question.options.map((option, index) => `
                        <button class="option-btn" data-index="${index}" onclick="selectOption(${index})">
                            ${option}
                        </button>
                    `).join('')}
                </div>
                <div class="controls">
                    <button class="action-btn shop-btn" onclick="openShop()">
                        üõí Tienda
                    </button>
                    <button class="action-btn" id="submit-btn" onclick="submitAnswer()" disabled>
                        Confirmar respuesta
                    </button>
                </div>
            `;
            
            selectedOption = null;
            document.getElementById('submit-btn').disabled = true;
            gameActive = true;
            minigameActive = false;
        }
        
        // Usar ayuda del personaje
        function useHelp() {
            if (helpTokens <= 0 || !gameActive) return;
            
            helpTokens--;
            const hint = getHint();
            const question = questions[currentQuestionIndex];
            const fullHint = `${hint} ${question.hint}`;
            
            // Mostrar la pista
            const messageElement = document.querySelector('.character-message');
            messageElement.innerHTML = `<strong>${currentCharacter.name}:</strong> ${fullHint}`;
            
            // Actualizar bot√≥n de ayuda
            const helpBtn = document.getElementById('help-btn');
            helpBtn.textContent = `Pedir ayuda (${helpTokens} restantes)`;
            if (helpTokens <= 0) {
                helpBtn.disabled = true;
            }
            
            // Dar un peque√±o bono de puntos por usar ayuda
            points += 5;
            updateUI();
        }
        
        // Seleccionar una opci√≥n
        function selectOption(index) {
            if (!gameActive || minigameActive) return;
            
            // Resetear todas las opciones
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Marcar la opci√≥n seleccionada
            const selectedBtn = document.querySelector(`.option-btn[data-index="${index}"]`);
            selectedBtn.classList.add('selected');
            selectedOption = index;
            
            // Habilitar el bot√≥n de enviar
            document.getElementById('submit-btn').disabled = false;
        }
        
        // Enviar respuesta
        function submitAnswer() {
            if (selectedOption === null || !gameActive || minigameActive) return;
            
            const question = questions[currentQuestionIndex];
            const optionButtons = document.querySelectorAll('.option-btn');
            const submitBtn = document.getElementById('submit-btn');
            
            // Deshabilitar todos los botones
            optionButtons.forEach(btn => {
                btn.disabled = true;
            });
            submitBtn.disabled = true;
            gameActive = false;
            
            clearInterval(timer);
            
            // Mostrar respuesta correcta e incorrecta
            optionButtons.forEach((btn, index) => {
                if (index === question.correctAnswer) {
                    btn.classList.add('correct');
                } else if (index === selectedOption && index !== question.correctAnswer) {
                    btn.classList.add('incorrect');
                }
            });
            
            // Verificar si la respuesta es correcta
            if (selectedOption === question.correctAnswer) {
                points += 20;
                updateUI();
                showMessage("¬°Correcto! +20 puntos. Preparando minijuego...");
            } else {
                loseHeart();
                showMessage("Incorrecto. Pierdes un coraz√≥n. Preparando minijuego...");
                
                if (hearts <= 0) {
                    return; // Ya se maneja en loseHeart()
                }
            }
            
            // Pasar al minijuego despu√©s de un breve retraso
            setTimeout(startMinigame, 2000);
        }
        
        // Mostrar un mensaje temporal
        function showMessage(message) {
            const messageElement = document.querySelector('.character-message');
            if (messageElement) {
                const originalContent = messageElement.innerHTML;
                messageElement.innerHTML = `<strong>Sistema:</strong> ${message}`;
                
                setTimeout(() => {
                    messageElement.innerHTML = originalContent;
                }, 2000);
            }
        }
        
        // Iniciar el minijuego
        function startMinigame() {
            minigameActive = true;
            plantedCrops = Array(15).fill(null);
            selectedCrop = crops[0];
            cropTimers = [];
            
            gameArea.innerHTML = `
                <div class="minigame-container">
                    <h2 class="minigame-title">üå± Minijuego de Cultivo üå±</h2>
                    <p class="minigame-instructions">
                        Selecciona un cultivo y planta en las parcelas vac√≠as. 
                        ¬°Cosecha cuando est√©n listos (se pondr√°n verdes) para ganar puntos extra!
                    </p>
                    
                    <div class="minigame-stats">
                        <div>Puntos del minijuego: <strong id="minigame-points">0</strong></div>
                        <div>Cultivo seleccionado: <strong id="selected-crop-name">Papa</strong></div>
                    </div>
                    
                    <div class="crop-selection">
                        ${crops.map((crop, index) => `
                            <div class="crop-option ${index === 0 ? 'selected' : ''}" onclick="selectCrop(${index})">
                                <span class="crop-icon">${crop.emoji}</span>
                                <div class="crop-name">${crop.name}</div>
                                <div class="crop-points">${crop.points} puntos</div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="farm-grid" id="farm-grid">
                        ${plantedCrops.map((crop, index) => `
                            <div class="farm-plot" id="plot-${index}" onclick="plantOrHarvest(${index})">
                                ${crop ? crop.emoji : 'üü´'}
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="minigame-controls">
                        <button class="action-btn shop-btn" onclick="skipMinigame()">
                            Saltar minijuego
                        </button>
                        <button class="action-btn" onclick="finishMinigame()">
                            Terminar cultivo
                        </button>
                    </div>
                </div>
            `;
        }
        
        // Seleccionar un cultivo en el minijuego
        function selectCrop(index) {
            selectedCrop = crops[index];
            
            // Actualizar selecci√≥n visual
            document.querySelectorAll('.crop-option').forEach((option, i) => {
                if (i === index) {
                    option.classList.add('selected');
                } else {
                    option.classList.remove('selected');
                }
            });
            
            document.getElementById('selected-crop-name').textContent = selectedCrop.name;
        }
        
        // Plantar o cosechar en una parcela
        function plantOrHarvest(plotIndex) {
            if (!minigameActive) return;
            
            const plot = document.getElementById(`plot-${plotIndex}`);
            const currentCrop = plantedCrops[plotIndex];
            
            // Si la parcela est√° vac√≠a, plantar
            if (!currentCrop) {
                plantedCrops[plotIndex] = selectedCrop;
                plot.textContent = selectedCrop.emoji;
                plot.classList.add('planted');
                
                // Iniciar temporizador para crecimiento
                const timerId = setTimeout(() => {
                    plot.classList.add('harvestable');
                    plot.classList.remove('planted');
                }, selectedCrop.growthTime);
                
                cropTimers[plotIndex] = timerId;
            }
            // Si la parcela est√° lista para cosechar
            else if (plot.classList.contains('harvestable')) {
                // Ganar puntos
                minigamePoints += currentCrop.points;
                document.getElementById('minigame-points').textContent = minigamePoints;
                
                // Limpiar parcela
                plantedCrops[plotIndex] = null;
                plot.textContent = 'üü´';
                plot.classList.remove('harvestable', 'planted');
                
                // Limpiar temporizador
                if (cropTimers[plotIndex]) {
                    clearTimeout(cropTimers[plotIndex]);
                    cropTimers[plotIndex] = null;
                }
            }
        }
        
        // Saltar el minijuego
        function skipMinigame() {
            // Limpiar todos los temporizadores
            cropTimers.forEach(timer => {
                if (timer) clearTimeout(timer);
            });
            
            finishMinigame();
        }
        
        // Terminar el minijuego
        function finishMinigame() {
            // Sumar puntos del minijuego a los puntos totales
            points += minigamePoints;
            
            // Limpiar todos los temporizadores
            cropTimers.forEach(timer => {
                if (timer) clearTimeout(timer);
            });
            
            // Mostrar mensaje de puntos ganados
            showMessage(`¬°Minijuego completado! Ganaste ${minigamePoints} puntos extra.`);
            
            // Pasar a la siguiente pregunta
            setTimeout(nextQuestion, 2000);
        }
        
        // Abrir la tienda
        function openShop() {
            if (minigameActive) return;
            
            gameArea.innerHTML = `
                <div class="shop-container">
                    <h2 class="shop-title">üõí Tienda de la Granja üõí</h2>
                    <p class="minigame-instructions">
                        Usa tus puntos para comprar mejoras. Tienes <strong>${points}</strong> puntos disponibles.
                    </p>
                    
                    <div class="shop-items">
                        ${shopItems.map(item => `
                            <div class="shop-item">
                                <div class="item-icon">${item.emoji}</div>
                                <div class="item-name">${item.name}</div>
                                <div class="item-cost">${item.cost} puntos</div>
                                <button class="buy-btn" onclick="buyItem(${item.id})" ${points < item.cost ? 'disabled' : ''}>
                                    Comprar
                                </button>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="minigame-controls">
                        <button class="action-btn" onclick="closeShop()">
                            Volver al juego
                        </button>
                    </div>
                </div>
            `;
            
            document.querySelector('.shop-container').style.display = 'block';
        }
        
        // Comprar un item de la tienda
        function buyItem(itemId) {
            const item = shopItems.find(i => i.id === itemId);
            
            if (points < item.cost) {
                showMessage("No tienes suficientes puntos.");
                return;
            }
            
            // Restar puntos
            points -= item.cost;
            updateUI();
            
            // Aplicar efecto
            switch(item.effect) {
                case 'addHeart':
                    if (hearts < 5) {
                        hearts++;
                        showMessage("¬°Has ganado un coraz√≥n extra!");
                    } else {
                        showMessage("Ya tienes el m√°ximo de corazones.");
                        points += item.cost; // Devolver puntos
                    }
                    break;
                    
                case 'addHint':
                    helpTokens++;
                    showMessage("¬°Has ganado una pista adicional!");
                    break;
                    
                case 'addTime':
                    if (timer) {
                        timeLeft += 10;
                        updateTimerDisplay();
                        showMessage("¬°Has ganado 10 segundos extra!");
                    }
                    break;
                    
                case 'doublePoints':
                    // El pr√≥ximo acierto dar√° doble puntos
                    showMessage("¬°Tu pr√≥xima respuesta correcta dar√° doble puntos!");
                    // Esta funcionalidad se implementar√≠a con una bandera
                    break;
            }
            
            // Actualizar tienda
            openShop();
        }
        
        // Cerrar la tienda
        function closeShop() {
            loadQuestion();
            startTimer();
        }
        
        // Pasar a la siguiente pregunta
        function nextQuestion() {
            currentQuestionIndex++;
            
            if (currentQuestionIndex < questions.length) {
                selectRandomCharacter();
                loadQuestion();
                startTimer();
            } else {
                showResults();
            }
        }
        
        // Mostrar resultados finales
        function showResults() {
            let message = "";
            let title = "";
            
            if (points >= 200) {
                title = "¬°Granjero Maestro!";
                message = "Tienes conocimientos excepcionales sobre la vida rural. ¬°Eres un verdadero experto!";
            } else if (points >= 150) {
                title = "¬°Agricultor Experimentado!";
                message = "Dominas el arte de la agricultura y la trivia rural. ¬°Excelente trabajo!";
            } else if (points >= 100) {
                title = "Granjero Aprendiz";
                message = "Tienes buenos conocimientos, pero a√∫n hay mucho por aprender sobre la vida rural.";
            } else {
                title = "Ciudadano de Pueblo";
                message = "Parece que necesitas pasar m√°s tiempo en una granja para familiarizarte con la vida rural.";
            }
            
            gameArea.innerHTML = `
                <div class="result-screen">
                    <h2 class="result-title">${title}</h2>
                    <div class="result-score">${points} pts</div>
                    <p class="result-message">${message}</p>
                    <p class="result-message">Completaste todas las preguntas y minijuegos.</p>
                    <button class="action-btn" onclick="initGame()">Jugar de nuevo</button>
                </div>
            `;
        }
        
        // Fin del juego (sin vidas)
        function gameOver() {
            gameArea.innerHTML = `
                <div class="result-screen">
                    <h2 class="result-title">¬°Se acabaron los corazones!</h2>
                    <div class="result-score">${points} pts</div>
                    <p class="result-message">Has perdido todas tus vidas. ¬°La granja necesita atenci√≥n constante!</p>
                    <p class="result-message">Pero no te rindas, vuelve a intentarlo.</p>
                    <button class="action-btn" onclick="initGame()">Reintentar</button>
                </div>
            `;
        }
        
        // Inicializar el juego al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>