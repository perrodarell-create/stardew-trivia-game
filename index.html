<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stardew Valley Trivia - 5 Niveles Tem√°ticos</title>
    <style>
        /* RESET Y BASE CON PIXEL ART */
        * { margin: 0; padding: 0; box-sizing: border-box; image-rendering: pixelated; }
        
        body { 
            background: #1a1f2b;
            font-family: 'Courier New', monospace;
            min-height: 100vh;
            padding: 15px;
            color: #333;
            image-rendering: pixelated;
        }
        
        .game-wrapper {
            max-width: 1200px;
            margin: 0 auto;
            background: #2c3e50;
            border-radius: 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.7);
            overflow: hidden;
            border: 8px solid #1a252f;
            image-rendering: pixelated;
        }
        
        /* HEADER CON NIVELES - PIXEL ART */
        .game-header {
            background: #1a252f;
            padding: 15px;
            color: white;
            position: relative;
            border-bottom: 4px solid #34495e;
        }
        
        .game-title {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 20px;
            text-shadow: 3px 3px 0 #000;
            color: #f1c40f;
            letter-spacing: 2px;
            font-family: 'Courier New', monospace;
        }
        
        .levels-nav {
            display: flex;
            justify-content: center;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        .level-btn {
            padding: 8px 16px;
            background: #34495e;
            border: 3px solid #2c3e50;
            border-radius: 0;
            color: #ecf0f1;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'Courier New', monospace;
            image-rendering: pixelated;
        }
        
        .level-btn:hover {
            transform: translateY(-2px);
            background: #4a6572;
            border-color: #f1c40f;
        }
        
        .level-btn.active {
            background: #f1c40f;
            color: #2c3e50;
            border-color: #f39c12;
            box-shadow: 0 4px 0 #d35400;
        }
        
        /* BARRA DE ESTAD√çSTICAS - PIXEL ART */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            padding: 12px;
            background: #34495e;
            border-bottom: 4px solid #2c3e50;
        }
        
        @media (max-width: 768px) {
            .stats-bar {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        .stat-card {
            background: #2c3e50;
            padding: 10px;
            border-radius: 0;
            text-align: center;
            box-shadow: inset 0 0 0 2px #1a252f;
            border: 3px solid;
            image-rendering: pixelated;
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: #bdc3c7;
            margin-bottom: 5px;
            font-family: 'Courier New', monospace;
        }
        
        .stat-value {
            font-size: 1.6rem;
            font-weight: bold;
            color: #ecf0f1;
            text-shadow: 2px 2px 0 #000;
        }
        
        .hearts-display {
            display: flex;
            justify-content: center;
            gap: 2px;
            margin-top: 5px;
        }
        
        .heart {
            font-size: 1.5rem;
        }
        
        /* √ÅREA DE JUEGO PRINCIPAL CON TEMAS */
        .game-main {
            display: grid;
            grid-template-columns: 3fr 2fr;
            gap: 15px;
            padding: 15px;
            min-height: 550px;
            background: #1a252f;
        }
        
        @media (max-width: 900px) {
            .game-main {
                grid-template-columns: 1fr;
            }
        }
        
        /* TEMAS PARA CADA NIVEL */
        .theme-agricultura {
            background: linear-gradient(to bottom, #27ae60, #2ecc71);
            border-color: #27ae60;
        }
        
        .theme-pesca {
            background: linear-gradient(to bottom, #2980b9, #3498db);
            border-color: #2980b9;
        }
        
        .theme-ganaderia {
            background: linear-gradient(to bottom, #e67e22, #f39c12);
            border-color: #e67e22;
        }
        
        .theme-mineria {
            background: linear-gradient(to bottom, #7f8c8d, #95a5a6);
            border-color: #7f8c8d;
        }
        
        .theme-tecnologia {
            background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%);
            border-color: #8e44ad;
            position: relative;
            overflow: hidden;
        }
        
        /* EFECTO DE INVERNADERO PARA TECNOLOG√çA */
        .greenhouse-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, transparent 49%, rgba(46, 204, 113, 0.1) 50%, transparent 51%),
                linear-gradient(transparent 49%, rgba(46, 204, 113, 0.1) 50%, transparent 51%);
            background-size: 20px 20px;
            pointer-events: none;
            z-index: 1;
        }
        
        .greenhouse-plants {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 60px;
            background: 
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 20"><rect x="10" y="5" width="5" height="15" fill="%2327ae60"/><rect x="15" y="0" width="10" height="10" fill="%232ecc71"/><rect x="30" y="8" width="5" height="12" fill="%2327ae60"/><rect x="35" y="3" width="8" height="8" fill="%232ecc71"/><rect x="55" y="3" width="5" height="17" fill="%2327ae60"/><rect x="60" y="0" width="12" height="12" fill="%232ecc71"/><rect x="80" y="7" width="5" height="13" fill="%2327ae60"/><rect x="85" y="2" width="9" height="9" fill="%232ecc71"/></svg>')
                repeat-x;
            z-index: 2;
        }
        
        /* PANEL DE JUEGO */
        .game-panel {
            background: rgba(44, 62, 80, 0.9);
            border-radius: 0;
            padding: 15px;
            border: 4px solid;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 3;
        }
        
        /* PANEL DE PREGUNTAS */
        .questions-panel {
            border-color: #27ae60;
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid rgba(0,0,0,0.3);
        }
        
        .level-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .level-icon {
            font-size: 2.5rem;
            filter: drop-shadow(2px 2px 0 #000);
        }
        
        .level-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ecf0f1;
            text-shadow: 2px 2px 0 #000;
        }
        
        .timer-box {
            background: #2c3e50;
            color: white;
            padding: 6px 15px;
            border-radius: 0;
            font-size: 1.2rem;
            font-weight: bold;
            border: 3px solid #34495e;
            box-shadow: inset 0 0 0 2px #1a252f;
        }
        
        .timer-box.warning {
            background: #f39c12;
            border-color: #e67e22;
            animation: pulse 1s infinite;
        }
        
        .timer-box.danger {
            background: #e74c3c;
            border-color: #c0392b;
            animation: pulse 0.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* PREGUNTA */
        .question-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .question-box {
            background: rgba(52, 73, 94, 0.9);
            padding: 20px;
            border-radius: 0;
            margin-bottom: 15px;
            box-shadow: inset 0 0 0 3px #1a252f;
            border-left: 6px solid #27ae60;
            flex-grow: 1;
            position: relative;
        }
        
        .question-text {
            font-size: 1.4rem;
            line-height: 1.6;
            color: #ecf0f1;
            margin-bottom: 20px;
            text-shadow: 1px 1px 0 #000;
        }
        
        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
        }
        
        .option-btn {
            padding: 12px;
            background: #34495e;
            border: 3px solid #2c3e50;
            border-radius: 0;
            text-align: left;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s;
            color: #ecf0f1;
            font-family: 'Courier New', monospace;
        }
        
        .option-btn:hover {
            background: #4a6572;
            transform: translateY(-2px);
            border-color: #f1c40f;
        }
        
        .option-btn.selected {
            background: #27ae60;
            color: white;
            border-color: #2ecc71;
            box-shadow: 0 4px 0 #219653;
        }
        
        .option-btn.correct {
            background: #2ecc71;
            color: white;
            border-color: #27ae60;
        }
        
        .option-btn.incorrect {
            background: #e74c3c;
            color: white;
            border-color: #c0392b;
        }
        
        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        /* PANEL DE INVENTARIO/MINIJUEGO */
        .inventory-panel {
            border-color: #f39c12;
            max-height: 550px;
            overflow-y: auto;
        }
        
        .inventory-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #f1c40f;
            margin-bottom: 15px;
            text-align: center;
            padding-bottom: 8px;
            border-bottom: 3px solid #f39c12;
            text-shadow: 2px 2px 0 #000;
        }
        
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .tool-item {
            background: #2c3e50;
            padding: 12px;
            border-radius: 0;
            text-align: center;
            border: 3px solid #34495e;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: inset 0 0 0 2px #1a252f;
        }
        
        .tool-item:hover {
            transform: translateY(-3px);
            border-color: #f1c40f;
        }
        
        .tool-item.active {
            background: #f39c12;
            border-color: #f1c40f;
            box-shadow: 0 4px 0 #e67e22;
        }
        
        .tool-icon {
            font-size: 2rem;
            margin-bottom: 5px;
            display: block;
            filter: drop-shadow(2px 2px 0 #000);
        }
        
        .tool-name {
            font-weight: bold;
            color: #ecf0f1;
            font-size: 0.9rem;
        }
        
        /* BOTONES DE ACCI√ìN - PIXEL ART */
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        @media (max-width: 500px) {
            .action-buttons {
                grid-template-columns: 1fr;
            }
        }
        
        .btn {
            padding: 12px;
            border: none;
            border-radius: 0;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: 'Courier New', monospace;
            box-shadow: 0 4px 0 rgba(0,0,0,0.3);
        }
        
        .btn-primary {
            background: linear-gradient(to bottom, #27ae60, #2ecc71);
            color: white;
            border: 3px solid #219653;
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #219653;
        }
        
        .btn-secondary {
            background: linear-gradient(to bottom, #e67e22, #f39c12);
            color: white;
            border: 3px solid #d35400;
        }
        
        .btn-secondary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #d35400;
        }
        
        .btn:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
            opacity: 0.7;
            border-color: #95a5a6;
        }
        
        /* PERSONAJES PNG - AYUDA EN TRIVIA */
        .character-help {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 120px;
            height: 150px;
            z-index: 1000;
            transition: all 0.5s;
            image-rendering: pixelated;
        }
        
        .character-img {
            width: 100%;
            height: 100%;
            filter: drop-shadow(3px 3px 0 #000);
        }
        
        .character-speech {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 10px 15px;
            border-radius: 5px;
            border: 3px solid #34495e;
            color: #2c3e50;
            font-weight: bold;
            min-width: 150px;
            text-align: center;
            box-shadow: 3px 3px 0 rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }
        
        .character-speech:after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 10px solid transparent;
            border-top-color: white;
        }
        
        /* MENSAJES */
        .message-toast {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #27ae60;
            color: white;
            padding: 12px 20px;
            border-radius: 0;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            animation: slideIn 0.3s ease;
            z-index: 1000;
            max-width: 350px;
            border: 3px solid #219653;
            font-family: 'Courier New', monospace;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        /* BARRA DE PROGRESO */
        .progress-bar {
            height: 10px;
            background: #34495e;
            border-radius: 0;
            overflow: hidden;
            margin: 10px 0;
            border: 2px solid #2c3e50;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #27ae60, #2ecc71);
            transition: width 0.3s ease;
        }
        
        /* TIENDA - PIXEL ART */
        .shop-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(26, 37, 47, 0.95);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .shop-modal {
            background: #2c3e50;
            width: 90%;
            max-width: 700px;
            border-radius: 0;
            padding: 20px;
            max-height: 80vh;
            overflow-y: auto;
            border: 8px solid #34495e;
            box-shadow: 0 10px 30px rgba(0,0,0,0.7);
        }
        
        .shop-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .shop-title {
            font-size: 2.2rem;
            color: #f1c40f;
            margin-bottom: 10px;
            text-shadow: 3px 3px 0 #000;
        }
        
        .shop-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .shop-item {
            background: #34495e;
            padding: 15px;
            border-radius: 0;
            text-align: center;
            border: 3px solid #2c3e50;
            transition: all 0.3s;
            box-shadow: inset 0 0 0 2px #1a252f;
        }
        
        .shop-item:hover {
            transform: translateY(-5px);
            border-color: #f1c40f;
        }
        
        .item-icon {
            font-size: 2.5rem;
            margin-bottom: 8px;
            filter: drop-shadow(2px 2px 0 #000);
        }
        
        .item-price {
            font-size: 1.3rem;
            color: #f1c40f;
            font-weight: bold;
            margin: 8px 0;
            text-shadow: 1px 1px 0 #000;
        }
        
        /* INDICADOR DE TIEMPO PAUSADO */
        .time-paused {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(231, 76, 60, 0.9);
            color: white;
            padding: 15px 30px;
            border-radius: 0;
            font-size: 1.8rem;
            font-weight: bold;
            z-index: 1500;
            animation: pulse 1.5s infinite;
            border: 5px solid #c0392b;
            text-shadow: 2px 2px 0 #000;
        }
        
        /* FONDO PIXEL ART PARA CADA NIVEL */
        .pixel-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: 40px 40px;
            opacity: 0.1;
            pointer-events: none;
            z-index: 0;
        }
        
        .bg-agricultura {
            background-image: 
                linear-gradient(45deg, #27ae60 25%, transparent 25%),
                linear-gradient(-45deg, #27ae60 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #27ae60 75%),
                linear-gradient(-45deg, transparent 75%, #27ae60 75%);
        }
        
        .bg-pesca {
            background-image: 
                radial-gradient(circle at 10px 10px, #2980b9 2px, transparent 3px);
            background-size: 30px 30px;
        }
        
        .bg-ganaderia {
            background-image: 
                repeating-linear-gradient(0deg, transparent, transparent 19px, #e67e22 20px),
                repeating-linear-gradient(90deg, transparent, transparent 19px, #e67e22 20px);
        }
        
        .bg-mineria {
            background-image: 
                linear-gradient(45deg, #7f8c8d 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #7f8c8d 75%),
                linear-gradient(45deg, transparent 75%, #7f8c8d 75%),
                linear-gradient(45deg, #7f8c8d 25%, #95a5a6 25%);
            background-size: 40px 40px;
            background-position: 0 0, 0 20px, 20px -20px, -20px 0px;
        }
        
        .bg-tecnologia {
            background-image: 
                linear-gradient(90deg, #8e44ad 50%, transparent 50%),
                linear-gradient(0deg, #8e44ad 50%, transparent 50%);
            background-size: 30px 30px;
        }
    </style>
</head>
<body>
    <div class="game-wrapper">
        <!-- HEADER CON SELECTOR DE NIVELES -->
        <header class="game-header">
            <h1 class="game-title">üåæ STARDEW VALLEY TRIVIA üåæ</h1>
            <nav class="levels-nav">
                <button class="level-btn active" onclick="loadLevel(0)">
                    <span>üå±</span> Agricultura
                </button>
                <button class="level-btn" onclick="loadLevel(1)">
                    <span>üé£</span> Pesca
                </button>
                <button class="level-btn" onclick="loadLevel(2)">
                    <span>üêî</span> Ganader√≠a
                </button>
                <button class="level-btn" onclick="loadLevel(3)">
                    <span>‚õèÔ∏è</span> Miner√≠a
                </button>
                <button class="level-btn" onclick="loadLevel(4)">
                    <span>üî¨</span> Tecnolog√≠a
                </button>
            </nav>
        </header>

        <!-- BARRA DE ESTAD√çSTICAS -->
        <div class="stats-bar">
            <div class="stat-card" style="border-left-color: #27ae60;">
                <div class="stat-label">PUNTOS</div>
                <div class="stat-value" id="total-points">0</div>
            </div>
            <div class="stat-card" style="border-left-color: #2980b9;">
                <div class="stat-label">NIVEL</div>
                <div class="stat-value" id="current-level">1</div>
            </div>
            <div class="stat-card" style="border-left-color: #e67e22;">
                <div class="stat-label">PREGUNTA</div>
                <div class="stat-value" id="current-question">1/5</div>
            </div>
            <div class="stat-card" style="border-left-color: #8e44ad;">
                <div class="stat-label">TIEMPO</div>
                <div class="stat-value" id="time-left">30s</div>
            </div>
            <div class="stat-card" style="border-left-color: #7f8c8d;">
                <div class="stat-label">CORAZONES</div>
                <div class="hearts-display" id="hearts-display">
                    ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è
                </div>
            </div>
        </div>

        <!-- √ÅREA DE JUEGO PRINCIPAL -->
        <main class="game-main">
            <!-- PANEL DE PREGUNTAS CON TEMA -->
            <section class="game-panel questions-panel theme-agricultura" id="questions-panel">
                <div class="pixel-background bg-agricultura"></div>
                <div class="panel-header">
                    <div class="level-info">
                        <div class="level-icon" id="level-icon">üå±</div>
                        <div>
                            <div class="level-title" id="level-title">AGRICULTURA</div>
                            <div id="level-progress" style="color:#ecf0f1;">Pregunta 1 de 5</div>
                        </div>
                    </div>
                    <div class="timer-box" id="timer-box">
                        ‚è±Ô∏è <span id="timer">30</span>s
                    </div>
                </div>

                <div class="question-container">
                    <div class="question-box">
                        <div class="question-text" id="question-text">
                            Cargando pregunta...
                        </div>
                        <div class="options-grid" id="options-container">
                            <!-- Las opciones se cargan aqu√≠ -->
                        </div>
                    </div>

                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-secondary" onclick="openShop()">
                            üõí Tienda
                        </button>
                        <button class="btn btn-primary" id="submit-btn" onclick="submitAnswer()" disabled>
                            ‚úÖ Confirmar Respuesta
                        </button>
                    </div>
                </div>
            </section>

            <!-- PANEL DE INVENTARIO Y MINIJUEGO -->
            <section class="game-panel inventory-panel">
                <div class="inventory-title">üéí INVENTARIO DEL NIVEL</div>
                
                <!-- INVENTARIO POR NIVEL -->
                <div id="inventory-content">
                    <div class="tools-grid">
                        <!-- Se carga din√°micamente seg√∫n el nivel -->
                    </div>
                </div>

                <!-- MINIJUEGO -->
                <div class="minigame-area" id="minigame-area">
                    <div class="minigame-title" id="minigame-title" style="color:#f1c40f;text-align:center;margin:10px 0;">üéÆ MINIJUEGO</div>
                    <canvas class="minigame-canvas" id="minigame-canvas" width="400" height="150" style="background:#2c3e50;border:3px solid #34495e;display:block;margin:0 auto;"></canvas>
                    <div class="minigame-controls" id="minigame-controls" style="color:#ecf0f1;text-align:center;margin:10px 0;">
                        Presiona üéÆ para jugar
                    </div>
                </div>

                <div class="action-buttons" style="margin-top: 15px;">
                    <button class="btn btn-secondary" onclick="useHint()" id="hint-btn">
                        üí° Pista (3)
                    </button>
                    <button class="btn btn-primary" id="minigame-btn" onclick="startMinigame()" disabled>
                        üéÆ Jugar Minijuego
                    </button>
                </div>
            </section>
        </main>
    </div>

    <!-- PERSONAJES DE AYUDA -->
    <div class="character-help" id="character-help" style="display:none;">
        <div class="character-speech" id="character-speech">¬°Hola! Aqu√≠ tienes una pista...</div>
        <img class="character-img" id="character-img" src="" alt="Personaje ayudante">
    </div>

    <!-- MODAL DE TIENDA -->
    <div class="shop-overlay" id="shop-overlay">
        <div class="shop-modal">
            <div class="shop-header">
                <h2 class="shop-title">üè™ TIENDA DE LA GRANJA</h2>
                <p style="color: #bdc3c7; margin: 10px 0;">
                    Puntos disponibles: <strong id="shop-balance" style="color:#f1c40f;">0</strong>
                </p>
                <p style="color: #27ae60; font-weight: bold; text-shadow: 1px 1px 0 #000;">
                    ‚è∏Ô∏è EL TIEMPO EST√Å PAUSADO
                </p>
            </div>

            <div class="shop-grid" id="shop-items">
                <!-- Items de tienda cargados din√°micamente -->
            </div>

            <div style="text-align: center;">
                <button class="btn btn-primary" onclick="closeShop()" style="padding: 15px 30px; font-size: 1.2rem;">
                    ‚Üê VOLVER AL JUEGO
                </button>
            </div>
        </div>
    </div>

    <!-- INDICADOR DE TIEMPO PAUSADO -->
    <div class="time-paused" id="time-paused" style="display: none;">
        ‚è∏Ô∏è TIEMPO PAUSADO
    </div>

    <script>
        // ==================== CONFIGURACI√ìN DEL JUEGO ====================
        const GAME = {
            // Niveles del juego con temas
            levels: [
                {
                    id: 0,
                    name: "Agricultura",
                    icon: "üå±",
                    color: "#27ae60",
                    theme: "agricultura",
                    questions: 5,
                    minigame: "planting",
                    tools: [
                        { name: "Azada", icon: "‚õèÔ∏è", desc: "Prepara la tierra" },
                        { name: "Regadera", icon: "üíß", desc: "Riega los cultivos" },
                        { name: "Semillas Fresa", icon: "üçì", desc: "Planta fresas" },
                        { name: "Semillas Ma√≠z", icon: "üåΩ", desc: "Planta ma√≠z" },
                        { name: "Semillas Zanah", icon: "ü•ï", desc: "Planta zanahorias" },
                        { name: "Cosechar", icon: "‚úÇÔ∏è", desc: "Recoge cultivos" }
                    ],
                    character: "farmer"
                },
                {
                    id: 1,
                    name: "Pesca",
                    icon: "üé£",
                    color: "#2980b9",
                    theme: "pesca",
                    questions: 5,
                    minigame: "fishing",
                    tools: [
                        { name: "Ca√±a B√°sica", icon: "üé£", desc: "Pesca simple" },
                        { name: "Cebo", icon: "ü™±", desc: "Atrae peces" },
                        { name: "Red", icon: "üï∏Ô∏è", desc: "Atrapa varios" },
                        { name: "Ca√±a Iridio", icon: "üåü", desc: "Pesca mejor" },
                        { name: "Cebo Dorado", icon: "üí∞", desc: "Pez especial" },
                        { name: "Cubeta", icon: "ü™£", desc: "Guarda peces" }
                    ],
                    character: "fisherman"
                },
                {
                    id: 2,
                    name: "Ganader√≠a",
                    icon: "üêî",
                    color: "#e67e22",
                    theme: "ganaderia",
                    questions: 5,
                    minigame: "animals",
                    tools: [
                        { name: "Alimento", icon: "üåæ", desc: "Alimenta animales" },
                        { name: "Cepillo", icon: "üßπ", desc: "Cepilla animales" },
                        { name: "Orde√±ador", icon: "ü•õ", desc: "Saca leche" },
                        { name: "Tijeras", icon: "‚úÇÔ∏è", desc: "Corta lana" },
                        { name: "Incubadora", icon: "ü•ö", desc: "Incuba huevos" },
                        { name: "Establo", icon: "üè†", desc: "Guarda animales" }
                    ],
                    character: "rancher"
                },
                {
                    id: 3,
                    name: "Miner√≠a",
                    icon: "‚õèÔ∏è",
                    color: "#7f8c8d",
                    theme: "mineria",
                    questions: 5,
                    minigame: "mining",
                    tools: [
                        { name: "Pico", icon: "‚õèÔ∏è", desc: "Rompe rocas" },
                        { name: "L√°mpara", icon: "üí°", desc: "Ilumina cueva" },
                        { name: "Explosivos", icon: "üí£", desc: "Destruye r√°pido" },
                        { name: "Botas", icon: "üë¢", desc: "Protege pies" },
                        { name: "Casco", icon: "‚õëÔ∏è", desc: "Protege cabeza" },
                        { name: "Mochila", icon: "üéí", desc: "Lleva minerales" }
                    ],
                    character: "miner"
                },
                {
                    id: 4,
                    name: "Tecnolog√≠a",
                    icon: "üî¨",
                    color: "#8e44ad",
                    theme: "tecnologia",
                    questions: 5,
                    minigame: "technology",
                    tools: [
                        { name: "Fertilizante", icon: "üß™", desc: "Mejora cultivos" },
                        { name: "Sprinkler", icon: "üöø", desc: "Riega solo" },
                        { name: "Mayonero", icon: "üç∂", desc: "Hace mayonesa" },
                        { name: "Quesera", icon: "üßÄ", desc: "Hace queso" },
                        { name: "Keg", icon: "üç∫", desc: "Hace jugo/vino" },
                        { name: "Invernadero", icon: "üè°", desc: "Cultiva todo a√±o" }
                    ],
                    character: "scientist"
                }
            ],

            // Personajes PNG (URLs de im√°genes pixel art)
            characters: {
                farmer: "https://images.unsplash.com/photo-1585320806297-9794b3e4eeae?w=150&h=150&fit=crop&crop=face&auto=format",
                fisherman: "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=150&h=150&fit=crop&crop=face&auto=format",
                rancher: "https://images.unsplash.com/photo-1546975490-a79abdd54533?w=150&h=150&fit=crop&crop=face&auto=format",
                miner: "https://images.unsplash.com/photo-1593113598332-cdcc2d4c2c8b?w=150&h=150&fit=crop&crop=face&auto=format",
                scientist: "https://images.unsplash.com/photo-1580894732444-8ecded7900cd?w=150&h=150&fit=crop&crop=face&auto=format"
            },

            // PREGUNTAS SIMPLES (para ni√±os)
            questions: {
                // AGRICULTURA (cultivos b√°sicos)
                0: [
                    { 
                        q: "¬øQu√© cultivo es rojo y dulce, crece en primavera?", 
                        a: ["Zanahoria", "Fresa", "Lechuga", "Papa"], 
                        correct: 1,
                        hint: "Es una fruta roja peque√±a"
                    },
                    { 
                        q: "¬øQu√© verdura es naranja y crece bajo tierra?", 
                        a: ["Tomate", "Zanahoria", "Pepino", "Cebolla"], 
                        correct: 1,
                        hint: "Los conejos la adoran"
                    },
                    { 
                        q: "¬øQu√© cultivo crece en una mazorca?", 
                        a: ["Arroz", "Trigo", "Ma√≠z", "Cebada"], 
                        correct: 2,
                        hint: "Es amarillo y tiene granos"
                    },
                    { 
                        q: "¬øQu√© fruta es verde por fuera y roja por dentro?", 
                        a: ["Manzana", "Sand√≠a", "Pera", "Uva"], 
                        correct: 1,
                        hint: "Tiene muchas semillas negras"
                    },
                    { 
                        q: "¬øQu√© necesita una planta para crecer?", 
                        a: ["Agua y sol", "TV y m√∫sica", "Ropa y zapatos", "Libros y l√°pices"], 
                        correct: 0,
                        hint: "Sin esto se seca"
                    }
                ],
                
                // PESCA (vida real simple)
                1: [
                    { 
                        q: "¬øD√≥nde viven la mayor√≠a de los peces?", 
                        a: ["En el bosque", "En el agua", "En el cielo", "En la monta√±a"], 
                        correct: 1,
                        hint: "Necesitan nadar"
                    },
                    { 
                        q: "¬øQu√© usas para atrapar un pez?", 
                        a: ["Red", "Cesta", "Cuerda", "Todos"], 
                        correct: 3,
                        hint: "Puedes usar varios m√©todos"
                    },
                    { 
                        q: "¬øQu√© pez es conocido por sus rayas negras?", 
                        a: ["Salm√≥n", "At√∫n", "Pez payaso", "Tibur√≥n"], 
                        correct: 2,
                        hint: "Vive con an√©monas"
                    },
                    { 
                        q: "¬øQu√© animal marino tiene 8 tent√°culos?", 
                        a: ["Estrella de mar", "Pulpo", "Medusa", "Cangrejo"], 
                        correct: 1,
                        hint: "Es muy inteligente"
                    },
                    { 
                        q: "¬øPor qu√© es importante no pescar demasiado?", 
                        a: ["Para que no se acaben", "Porque es aburrido", "Porque es caro", "Porque duele"], 
                        correct: 0,
                        hint: "Para que haya peces ma√±ana"
                    }
                ],
                
                // GANADER√çA (animales b√°sicos)
                2: [
                    { 
                        q: "¬øQu√© animal da leche?", 
                        a: ["Gallina", "Vaca", "Cerdo", "Oveja"], 
                        correct: 1,
                        hint: "Es grande con manchas"
                    },
                    { 
                        q: "¬øQu√© animal pone huevos?", 
                        a: ["Vaca", "Conejo", "Gallina", "Cabra"], 
                        correct: 2,
                        hint: "Hace 'cococo'"
                    },
                    { 
                        q: "¬øDe qu√© animal obtenemos lana?", 
                        a: ["Cerdo", "Pato", "Oveja", "Caballo"], 
                        correct: 2,
                        hint: "Parece una nube"
                    },
                    { 
                        q: "¬øQu√© animal hace 'oink oink'?", 
                        a: ["Vaca", "Cerdo", "Gallina", "Cabra"], 
                        correct: 1,
                        hint: "Le gusta el barro"
                    },
                    { 
                        q: "¬øQu√© necesitan todos los animales?", 
                        a: ["Comida y agua", "TV y radio", "Ropa y zapatos", "Libros y cuadernos"], 
                        correct: 0,
                        hint: "Sin esto no viven"
                    }
                ],
                
                // MINER√çA (b√°sico)
                3: [
                    { 
                        q: "¬øQu√© usamos para romper rocas?", 
                        a: ["Martillo", "Pico", "Paleta", "Cuchillo"], 
                        correct: 1,
                        hint: "Tiene punta afilada"
                    },
                    { 
                        q: "¬øQu√© metal es amarillo y valioso?", 
                        a: ["Hierro", "Cobre", "Oro", "Plata"], 
                        correct: 2,
                        hint: "Los piratas lo buscan"
                    },
                    { 
                        q: "¬øD√≥nde se encuentra el carb√≥n?", 
                        a: ["En el cielo", "Bajo tierra", "En el mar", "En los √°rboles"], 
                        correct: 1,
                        hint: "Es negro como la noche"
                    },
                    { 
                        q: "¬øQu√© piedra preciosa es roja?", 
                        a: ["Zafiro", "Rub√≠", "Esmeralda", "Diamante"], 
                        correct: 1,
                        hint: "Color de sangre"
                    },
                    { 
                        q: "¬øPor qu√© usamos casco en minas?", 
                        a: ["Por moda", "Para ver mejor", "Para proteger cabeza", "Para o√≠r mejor"], 
                        correct: 2,
                        hint: "Evita golpes"
                    }
                ],
                
                // TECNOLOG√çA (agr√≠cola simple)
                4: [
                    { 
                        q: "¬øQu√© m√°quina riega solo las plantas?", 
                        a: ["Sprinkler", "Tractor", "Cosechadora", "Podadora"], 
                        correct: 0,
                        hint: "Roc√≠a agua como lluvia"
                    },
                    { 
                        q: "¬øQu√© hace un invernadero?", 
                        a: ["Protege del fr√≠o", "Da sombra", "Ahuyenta p√°jaros", "Hace m√∫sica"], 
                        correct: 0,
                        hint: "Permite cultivar en invierno"
                    },
                    { 
                        q: "¬øQu√© convierte leche en queso?", 
                        a: ["Licuadora", "Quesera", "Horno", "Nevera"], 
                        correct: 1,
                        hint: "Empieza con Q"
                    },
                    { 
                        q: "¬øQu√© ayuda a las plantas a crecer mejor?", 
                        a: ["Fertilizante", "Pintura", "Jab√≥n", "Aceite"], 
                        correct: 0,
                        hint: "Como vitaminas para plantas"
                    },
                    { 
                        q: "¬øQu√© usa energ√≠a solar en la granja?", 
                        a: ["Paneles solares", "Molino viento", "Generador", "Bater√≠as"], 
                        correct: 0,
                        hint: "Usa el sol"
                    }
                ]
            },

            // Items de tienda
            shopItems: [
                { id: 1, name: "Vida Extra", icon: "‚ù§Ô∏è", price: 50, effect: "addHeart", desc: "+1 coraz√≥n" },
                { id: 2, name: "Tiempo Extra", icon: "‚è∞", price: 40, effect: "addTime", desc: "+10 segundos" },
                { id: 3, name: "Pistas Extra", icon: "üí°", price: 30, effect: "addHints", desc: "+3 pistas" },
                { id: 4, name: "Ca√±a Iridio", icon: "üé£", price: 100, effect: "iridiumRod", desc: "Pesca + f√°cil" },
                { id: 5, name: "Semillas Mejoradas", icon: "üåü", price: 60, effect: "betterSeeds", desc: "+50% puntos" }
            ],

            // Estado del juego
            state: {
                totalPoints: 0,
                currentLevel: 0,
                currentQuestion: 0,
                questionsAnswered: 0,
                hearts: 5,
                hints: 3,
                timeLeft: 30,
                timer: null,
                selectedAnswer: null,
                minigameActive: false,
                timePaused: false,
                shopOpen: false,
                characterVisible: false
            }
        };

        // ==================== INICIALIZACI√ìN ====================
        function initGame() {
            // Cargar primer nivel
            loadLevel(0);
            
            // Iniciar temporizador
            startTimer();
            
            showMessage("¬°Bienvenido a Stardew Valley Trivia! Responde preguntas simples y divi√©rtete.");
        }

        // ==================== SISTEMA DE NIVELES ====================
        function loadLevel(levelId) {
            // Resetear estado del nivel
            GAME.state.currentLevel = levelId;
            GAME.state.currentQuestion = 0;
            GAME.state.questionsAnswered = 0;
            GAME.state.hints = 3;
            GAME.state.selectedAnswer = null;
            GAME.state.minigameActive = false;
            
            const level = GAME.levels[levelId];
            
            // Actualizar UI
            document.querySelectorAll('.level-btn').forEach((btn, idx) => {
                btn.classList.toggle('active', idx === levelId);
            });
            
            document.getElementById('level-icon').textContent = level.icon;
            document.getElementById('level-title').textContent = level.name;
            document.getElementById('current-level').textContent = levelId + 1;
            
            // Aplicar tema visual al panel de preguntas
            const questionsPanel = document.getElementById('questions-panel');
            questionsPanel.className = 'game-panel questions-panel';
            questionsPanel.classList.add(`theme-${level.theme}`);
            
            // Limpiar efectos especiales previos
            document.querySelectorAll('.greenhouse-effect, .greenhouse-plants').forEach(el => el.remove());
            
            // A√±adir efecto de invernadero para tecnolog√≠a
            if (levelId === 4) {
                const greenhouseEffect = document.createElement('div');
                greenhouseEffect.className = 'greenhouse-effect';
                questionsPanel.appendChild(greenhouseEffect);
                
                const greenhousePlants = document.createElement('div');
                greenhousePlants.className = 'greenhouse-plants';
                questionsPanel.appendChild(greenhousePlants);
                
                // A√±adir fondo pixel art
                const pixelBg = document.querySelector('.pixel-background');
                if (pixelBg) pixelBg.className = 'pixel-background bg-tecnologia';
            } else {
                // Cambiar fondo pixel art seg√∫n tema
                const pixelBg = document.querySelector('.pixel-background');
                if (pixelBg) pixelBg.className = `pixel-background bg-${level.theme}`;
            }
            
            // Actualizar corazones
            updateHearts();
            
            // Actualizar inventario
            updateInventory();
            
            // Actualizar botones
            document.getElementById('hint-btn').textContent = `üí° Pista (${GAME.state.hints})`;
            document.getElementById('minigame-btn').disabled = true;
            
            // Cargar primera pregunta
            loadQuestion();
            
            showMessage(`Nivel cargado: ${level.name}`);
        }

        function updateInventory() {
            const level = GAME.levels[GAME.state.currentLevel];
            const toolsGrid = document.querySelector('.tools-grid');
            
            toolsGrid.innerHTML = '';
            
            level.tools.forEach((tool, index) => {
                const toolDiv = document.createElement('div');
                toolDiv.className = 'tool-item';
                if (index === 0) toolDiv.classList.add('active');
                toolDiv.onclick = () => selectTool(index);
                toolDiv.innerHTML = `
                    <span class="tool-icon">${tool.icon}</span>
                    <div class="tool-name">${tool.name}</div>
                `;
                toolsGrid.appendChild(toolDiv);
            });
        }

        function selectTool(index) {
            document.querySelectorAll('.tool-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelectorAll('.tool-item')[index].classList.add('active');
            
            const tool = GAME.levels[GAME.state.currentLevel].tools[index];
            showMessage(`Seleccionado: ${tool.name} - ${tool.desc}`);
        }

        // ==================== SISTEMA DE PREGUNTAS ====================
        function loadQuestion() {
            const level = GAME.state.currentLevel;
            const question = GAME.questions[level][GAME.state.currentQuestion];
            
            if (!question) {
                completeLevel();
                return;
            }
            
            // Actualizar UI
            document.getElementById('question-text').textContent = question.q;
            document.getElementById('current-question').textContent = `${GAME.state.currentQuestion + 1}/5`;
            document.getElementById('level-progress').textContent = `Pregunta ${GAME.state.currentQuestion + 1} de 5`;
            document.getElementById('progress-fill').style.width = `${(GAME.state.questionsAnswered / 5) * 100}%`;
            
            // Cargar opciones
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            question.a.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-btn';
                button.textContent = option;
                button.onclick = () => selectAnswer(index);
                optionsContainer.appendChild(button);
            });
            
            // Resetear selecci√≥n
            document.getElementById('submit-btn').disabled = true;
            GAME.state.selectedAnswer = null;
            
            // Reiniciar temporizador
            resetTimer();
            
            // Ocultar personaje si est√° visible
            hideCharacter();
        }

        function selectAnswer(index) {
            // Remover selecci√≥n anterior
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Marcar nueva selecci√≥n
            const buttons = document.querySelectorAll('.option-btn');
            buttons[index].classList.add('selected');
            
            // Habilitar bot√≥n de enviar
            document.getElementById('submit-btn').disabled = false;
            GAME.state.selectedAnswer = index;
        }

        function submitAnswer() {
            if (GAME.state.selectedAnswer === null) return;
            
            const level = GAME.state.currentLevel;
            const question = GAME.questions[level][GAME.state.currentQuestion];
            const buttons = document.querySelectorAll('.option-btn');
            
            // Deshabilitar interacci√≥n
            buttons.forEach(btn => btn.disabled = true);
            document.getElementById('submit-btn').disabled = true;
            document.getElementById('hint-btn').disabled = true;
            
            // Detener temporizador
            clearInterval(GAME.state.timer);
            
            // Marcar respuestas correctas/incorrectas
            buttons.forEach((btn, index) => {
                if (index === question.correct) {
                    btn.classList.add('correct');
                } else if (index === GAME.state.selectedAnswer) {
                    btn.classList.add('incorrect');
                }
            });
            
            // Verificar respuesta
            if (GAME.state.selectedAnswer === question.correct) {
                // Respuesta correcta
                GAME.state.totalPoints += 25;
                GAME.state.questionsAnswered++;
                showMessage("¬°Correcto! +25 puntos");
                
                // Actualizar puntos
                document.getElementById('total-points').textContent = GAME.state.totalPoints;
            } else {
                // Respuesta incorrecta
                GAME.state.hearts--;
                updateHearts();
                showMessage(`Incorrecto. La respuesta correcta es: "${question.a[question.correct]}"`);
                
                if (GAME.state.hearts <= 0) {
                    setTimeout(gameOver, 1000);
                    return;
                }
            }
            
            // Actualizar progreso
            document.getElementById('progress-fill').style.width = `${(GAME.state.questionsAnswered / 5) * 100}%`;
            
            // Pasar a siguiente pregunta despu√©s de 2 segundos
            setTimeout(() => {
                GAME.state.currentQuestion++;
                
                if (GAME.state.currentQuestion < 5) {
                    loadQuestion();
                    document.getElementById('hint-btn').disabled = false;
                    startTimer();
                } else {
                    completeLevel();
                }
            }, 2000);
        }

        function completeLevel() {
            const level = GAME.levels[GAME.state.currentLevel];
            
            // Dar puntos por completar nivel
            GAME.state.totalPoints += 100;
            document.getElementById('total-points').textContent = GAME.state.totalPoints;
            
            // Habilitar minijuego
            document.getElementById('minigame-btn').disabled = false;
            
            // Mostrar personaje felicitando
            showCharacter(level.character, `¬°${level.name} completado! +100 puntos. ¬°Ahora juega el minijuego!`);
            
            // Ocultar personaje despu√©s de 5 segundos
            setTimeout(hideCharacter, 5000);
        }

        // ==================== SISTEMA DE PISTAS CON PERSONAJES ====================
        function useHint() {
            if (GAME.state.hints <= 0) {
                showMessage("No tienes m√°s pistas");
                return;
            }
            
            GAME.state.hints--;
            document.getElementById('hint-btn').textContent = `üí° Pista (${GAME.state.hints})`;
            
            const level = GAME.state.currentLevel;
            const question = GAME.questions[level][GAME.state.currentQuestion];
            
            // Mostrar pista con personaje
            const levelData = GAME.levels[level];
            showCharacter(levelData.character, `üí° Pista: ${question.hint}`);
            
            // Ocultar personaje despu√©s de 4 segundos
            setTimeout(hideCharacter, 4000);
        }

        // ==================== SISTEMA DE PERSONAJES ====================
        function showCharacter(characterType, message) {
            const characterHelp = document.getElementById('character-help');
            const characterImg = document.getElementById('character-img');
            const characterSpeech = document.getElementById('character-speech');
            
            // Configurar personaje
            characterImg.src = GAME.characters[characterType];
            characterImg.alt = `Personaje de ${characterType}`;
            characterSpeech.textContent = message;
            
            // Mostrar personaje con animaci√≥n
            characterHelp.style.display = 'block';
            characterHelp.style.transform = 'translateX(100px)';
            characterHelp.style.opacity = '0';
            
            setTimeout(() => {
                characterHelp.style.transform = 'translateX(0)';
                characterHelp.style.opacity = '1';
            }, 10);
            
            GAME.state.characterVisible = true;
        }

        function hideCharacter() {
            if (!GAME.state.characterVisible) return;
            
            const characterHelp = document.getElementById('character-help');
            characterHelp.style.transform = 'translateX(100px)';
            characterHelp.style.opacity = '0';
            
            setTimeout(() => {
                characterHelp.style.display = 'none';
                GAME.state.characterVisible = false;
            }, 500);
        }

        // ==================== SISTEMA DE TIEMPO ====================
        function startTimer() {
            if (GAME.state.timePaused) return;
            
            clearInterval(GAME.state.timer);
            GAME.state.timeLeft = 30;
            updateTimerDisplay();
            
            GAME.state.timer = setInterval(() => {
                if (!GAME.state.timePaused) {
                    GAME.state.timeLeft--;
                    updateTimerDisplay();
                    
                    if (GAME.state.timeLeft <= 0) {
                        clearInterval(GAME.state.timer);
                        timeUp();
                    }
                }
            }, 1000);
        }

        function resetTimer() {
            GAME.state.timeLeft = 30;
            updateTimerDisplay();
        }

        function updateTimerDisplay() {
            const timerBox = document.getElementById('timer-box');
            const timerText = document.getElementById('timer');
            
            timerText.textContent = GAME.state.timeLeft;
            document.getElementById('time-left').textContent = `${GAME.state.timeLeft}s`;
            
            // Cambiar color seg√∫n tiempo
            timerBox.className = 'timer-box';
            if (GAME.state.timeLeft <= 10) {
                timerBox.classList.add('danger');
            } else if (GAME.state.timeLeft <= 20) {
                timerBox.classList.add('warning');
            }
        }

        function timeUp() {
            GAME.state.hearts--;
            updateHearts();
            showMessage("¬°Se acab√≥ el tiempo! Pierdes un coraz√≥n.");
            
            if (GAME.state.hearts <= 0) {
                setTimeout(gameOver, 1000);
                return;
            }
            
            // Pasar autom√°ticamente a siguiente pregunta
            setTimeout(() => {
                GAME.state.currentQuestion++;
                if (GAME.state.currentQuestion < 5) {
                    loadQuestion();
                    startTimer();
                } else {
                    completeLevel();
                }
            }, 2000);
        }

        function updateHearts() {
            let heartsHTML = '';
            for (let i = 0; i < 5; i++) {
                heartsHTML += i < GAME.state.hearts ? '‚ù§Ô∏è' : 'ü§ç';
            }
            document.getElementById('hearts-display').innerHTML = heartsHTML;
        }

        // ==================== TIENDA ====================
        function openShop() {
            // Pausar el tiempo
            GAME.state.timePaused = true;
            clearInterval(GAME.state.timer);
            document.getElementById('time-paused').style.display = 'block';
            
            document.getElementById('shop-overlay').style.display = 'flex';
            document.getElementById('shop-balance').textContent = GAME.state.totalPoints;
            updateShopItems();
            
            // Ocultar personaje si est√° visible
            hideCharacter();
        }

        function closeShop() {
            // Reanudar el tiempo
            GAME.state.timePaused = false;
            document.getElementById('time-paused').style.display = 'none';
            
            document.getElementById('shop-overlay').style.display = 'none';
            
            // Si hay pregunta activa, reanudar temporizador
            if (GAME.state.currentQuestion < 5) {
                startTimer();
            }
        }

        function updateShopItems() {
            const shopItems = document.getElementById('shop-items');
            shopItems.innerHTML = '';
            
            GAME.shopItems.forEach(item => {
                const canAfford = GAME.state.totalPoints >= item.price;
                
                const itemDiv = document.createElement('div');
                itemDiv.className = 'shop-item';
                itemDiv.innerHTML = `
                    <div class="item-icon">${item.icon}</div>
                    <h3 style="color:#ecf0f1;margin:5px 0;">${item.name}</h3>
                    <p style="color: #bdc3c7; font-size: 0.9rem; margin: 10px 0;">${item.desc}</p>
                    <div class="item-price">${item.price} puntos</div>
                    <button class="btn" onclick="buyItem(${item.id})" 
                            ${!canAfford ? 'disabled' : ''}
                            style="padding: 10px; font-size: 0.9rem; width: 100%; background:${canAfford?'#27ae60':'#7f8c8d'};">
                        ${canAfford ? 'COMPRAR' : 'POCOS PUNTOS'}
                    </button>
                `;
                
                shopItems.appendChild(itemDiv);
            });
        }

        function buyItem(itemId) {
            const item = GAME.shopItems.find(i => i.id === itemId);
            
            if (!item || GAME.state.totalPoints < item.price) {
                showMessage("No tienes suficientes puntos");
                return;
            }
            
            // Restar puntos
            GAME.state.totalPoints -= item.price;
            document.getElementById('total-points').textContent = GAME.state.totalPoints;
            document.getElementById('shop-balance').textContent = GAME.state.totalPoints;
            
            // Aplicar efecto
            switch(item.effect) {
                case 'addHeart':
                    if (GAME.state.hearts < 10) {
                        GAME.state.hearts++;
                        updateHearts();
                        showMessage("‚ù§Ô∏è +1 coraz√≥n extra");
                    }
                    break;
                case 'addTime':
                    showMessage("‚è∞ +10 segundos en cada pregunta");
                    break;
                case 'addHints':
                    GAME.state.hints += 3;
                    document.getElementById('hint-btn').textContent = `üí° Pista (${GAME.state.hints})`;
                    showMessage("üí° +3 pistas adicionales");
                    break;
                case 'iridiumRod':
                case 'betterSeeds':
                    showMessage(`¬°${item.name} adquirido! Se aplicar√° en el minijuego`);
                    break;
            }
            
            showMessage(`¬°${item.name} comprado por ${item.price} puntos!`);
            updateShopItems();
        }

        // ==================== MINIJUEGOS ====================
        function startMinigame() {
            const level = GAME.levels[GAME.state.currentLevel];
            showMessage(`¬°Minijuego de ${level.name} iniciado! Pr√≥ximamente...`);
        }

        // ==================== UTILIDADES ====================
        function showMessage(text) {
            const message = document.createElement('div');
            message.className = 'message-toast';
            message.textContent = text;
            document.body.appendChild(message);
            
            setTimeout(() => {
                if (message.parentNode) {
                    message.parentNode.removeChild(message);
                }
            }, 3000);
        }

        function gameOver() {
            showMessage(`¬°Juego Terminado! Puntos finales: ${GAME.state.totalPoints}`);
            
            // Deshabilitar botones
            document.getElementById('submit-btn').disabled = true;
            document.getElementById('minigame-btn').disabled = true;
            document.getElementById('hint-btn').disabled = true;
            
            // Mostrar bot√≥n de reinicio
            const gameOverMsg = document.createElement('div');
            gameOverMsg.className = 'message-toast';
            gameOverMsg.style.background = '#e74c3c';
            gameOverMsg.style.borderColor = '#c0392b';
            gameOverMsg.innerHTML = `
                <div style="text-align: center;">
                    <h3 style="margin-bottom:10px;">¬°GAME OVER!</h3>
                    <p style="margin-bottom:10px;">Puntos: ${GAME.state.totalPoints}</p>
                    <button onclick="restartGame()" style="
                        background: white; color: #e74c3c; border: 3px solid #c0392b;
                        padding: 10px 20px; border-radius: 0; margin-top: 10px;
                        font-weight: bold; cursor: pointer; font-family: 'Courier New';
                        box-shadow: 0 4px 0 #c0392b;">
                        üîÑ JUGAR OTRA VEZ
                    </button>
                </div>
            `;
            document.body.appendChild(gameOverMsg);
        }

        function restartGame() {
            // Resetear estado
            GAME.state = {
                totalPoints: 0,
                currentLevel: 0,
                currentQuestion: 0,
                questionsAnswered: 0,
                hearts: 5,
                hints: 3,
                timeLeft: 30,
                timer: null,
                selectedAnswer: null,
                minigameActive: false,
                timePaused: false,
                shopOpen: false,
                characterVisible: false
            };
            
            // Limpiar mensajes
            document.querySelectorAll('.message-toast').forEach(msg => msg.remove());
            
            // Reiniciar juego
            loadLevel(0);
            startTimer();
            
            // Ocultar personaje
            hideCharacter();
            
            showMessage("¬°Nuevo juego comenzado! Buena suerte.");
        }

        // ==================== INICIAR JUEGO ====================
        window.onload = initGame;
    </script>
</body>
</html>
